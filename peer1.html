<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Peer 1 - WebRTC Demo</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸŸ¢ Peer 1</h1>
      <div class="status" id="status">Disconnected</div>
    </div>

    <div class="info-box">
      <h3>ğŸ“š à¸„à¸³à¸­à¸˜à¸´à¸šà¸²à¸¢ WebRTC Components:</h3>
      <div class="explanation">
        <p><strong>1. STUN Server (Session Traversal Utilities for NAT)</strong></p>
        <ul>
          <li>à¸Šà¹ˆà¸§à¸¢à¹ƒà¸«à¹‰ peer à¸„à¹‰à¸™à¸«à¸² Public IP Address à¸‚à¸­à¸‡à¸•à¸±à¸§à¹€à¸­à¸‡</li>
          <li>à¹ƒà¸Šà¹‰à¹€à¸¡à¸·à¹ˆà¸­à¸­à¸¢à¸¹à¹ˆà¸«à¸¥à¸±à¸‡ NAT/Firewall à¹€à¸à¸·à¹ˆà¸­à¸«à¸² external IP</li>
          <li>à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡: stun:stun.l.google.com:19302</li>
          <li>à¹„à¸¡à¹ˆà¹„à¸”à¹‰à¸ªà¹ˆà¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸œà¹ˆà¸²à¸™ STUN, à¹à¸„à¹ˆà¸Šà¹ˆà¸§à¸¢à¸„à¹‰à¸™à¸«à¸² IP</li>
        </ul>

        <p><strong>2. TURN Server (Traversal Using Relays around NAT)</strong></p>
        <ul>
          <li>à¹ƒà¸Šà¹‰à¹€à¸¡à¸·à¹ˆà¸­ STUN à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¸—à¸³à¸‡à¸²à¸™à¹„à¸”à¹‰ (NAT à¹€à¸‚à¹‰à¸¡à¸‡à¸§à¸”)</li>
          <li>à¸—à¸³à¸«à¸™à¹‰à¸²à¸—à¸µà¹ˆà¹€à¸›à¹‡à¸™à¸•à¸±à¸§à¸à¸¥à¸²à¸‡à¸ªà¹ˆà¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸£à¸°à¸«à¸§à¹ˆà¸²à¸‡ peer</li>
          <li>à¹ƒà¸Šà¹‰ bandwidth à¸¡à¸²à¸à¸à¸§à¹ˆà¸² à¹€à¸à¸£à¸²à¸°à¸ªà¹ˆà¸‡à¸œà¹ˆà¸²à¸™ relay server</li>
          <li>à¹€à¸›à¹‡à¸™ fallback option à¹€à¸¡à¸·à¹ˆà¸­à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­à¸•à¸£à¸‡à¹„à¸¡à¹ˆà¹„à¸”à¹‰</li>
        </ul>

        <p><strong>3. Signalling Server</strong></p>
        <ul>
          <li>à¹„à¸¡à¹ˆà¹„à¸”à¹‰à¹€à¸›à¹‡à¸™à¸ªà¹ˆà¸§à¸™à¸«à¸™à¸¶à¹ˆà¸‡à¸‚à¸­à¸‡ WebRTC à¹à¸•à¹ˆà¸ˆà¸³à¹€à¸›à¹‡à¸™à¸•à¹‰à¸­à¸‡à¸¡à¸µ</li>
          <li>à¹ƒà¸Šà¹‰à¸ªà¸³à¸«à¸£à¸±à¸šà¹à¸¥à¸à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™ SDP (Session Description) à¹à¸¥à¸° ICE Candidates</li>
          <li>à¸«à¸¥à¸±à¸‡à¸ˆà¸²à¸à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­à¸ªà¸³à¹€à¸£à¹‡à¸ˆ à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ˆà¸°à¸ªà¹ˆà¸‡à¸•à¸£à¸‡à¸£à¸°à¸«à¸§à¹ˆà¸²à¸‡ peer (P2P)</li>
          <li>à¹ƒà¸™à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡à¸™à¸µà¹‰à¹ƒà¸Šà¹‰ Socket.io</li>
        </ul>
      </div>
    </div>

    <div class="peers-section">
      <h3>Available Peers:</h3>
      <div id="peersList"></div>
    </div>

    <div class="connection-info" id="connectionInfo"></div>

    <div class="chat-box">
      <div class="messages" id="messages"></div>
      <div class="input-group">
        <input type="text" id="messageInput" placeholder="à¸à¸´à¸¡à¸à¹Œà¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡..." disabled>
        <button id="sendBtn" disabled>à¸ªà¹ˆà¸‡</button>
      </div>
    </div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // PEER 1 - WebRTC Client Side
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // 1. à¸•à¸±à¸§à¹à¸›à¸£à¸à¸·à¹‰à¸™à¸à¸²à¸™
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const PEER_ID = 'peer1';              // à¸Šà¸·à¹ˆà¸­à¸‚à¸­à¸‡ peer à¸™à¸µà¹‰
    const socket = io();                   // à¸ªà¸£à¹‰à¸²à¸‡à¸à¸²à¸£à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­ Socket.io à¸à¸±à¸š server
    let peerConnection = null;             // RTCPeerConnection object (à¸«à¸±à¸§à¹ƒà¸ˆà¸‚à¸­à¸‡ WebRTC)
    let dataChannel = null;                // RTCDataChannel à¸ªà¸³à¸«à¸£à¸±à¸šà¸ªà¹ˆà¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡
    let remotePeerId = null;               // à¹€à¸à¹‡à¸šà¸Šà¸·à¹ˆà¸­ peer à¸—à¸µà¹ˆà¹€à¸£à¸²à¸ˆà¸°à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­à¸”à¹‰à¸§à¸¢

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // 2. Configuration à¸ªà¸³à¸«à¸£à¸±à¸š WebRTC
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // à¸à¸³à¸«à¸™à¸” STUN servers à¸ªà¸³à¸«à¸£à¸±à¸šà¸«à¸² public IP address
    const configuration = {
      iceServers: [
        {
          urls: 'stun:stun.l.google.com:19302'    // STUN server à¸‚à¸­à¸‡ Google (à¸Ÿà¸£à¸µ)
        },
        {
          urls: 'stun:stun1.l.google.com:19302'   // STUN server à¸ªà¸³à¸£à¸­à¸‡
        }
        // à¸«à¸¡à¸²à¸¢à¹€à¸«à¸•à¸¸: à¸–à¹‰à¸²à¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¹ƒà¸Šà¹‰ TURN server à¹ƒà¸«à¹‰à¹€à¸à¸´à¹ˆà¸¡à¸—à¸µà¹ˆà¸™à¸µà¹ˆ
        // {
        //   urls: 'turn:your-turn-server.com:3478',
        //   username: 'user',
        //   credential: 'pass'
        // }
      ]
    };

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // 3. à¹€à¸à¹‡à¸š reference à¸‚à¸­à¸‡ DOM elements
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const statusEl = document.getElementById('status');              // à¹à¸ªà¸”à¸‡à¸ªà¸–à¸²à¸™à¸°à¸à¸²à¸£à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­
    const messagesEl = document.getElementById('messages');          // à¸à¸·à¹‰à¸™à¸—à¸µà¹ˆà¹à¸ªà¸”à¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡
    const messageInput = document.getElementById('messageInput');    // à¸Šà¹ˆà¸­à¸‡à¸à¸´à¸¡à¸à¹Œà¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡
    const sendBtn = document.getElementById('sendBtn');              // à¸›à¸¸à¹ˆà¸¡à¸ªà¹ˆà¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡
    const peersListEl = document.getElementById('peersList');        // à¸£à¸²à¸¢à¸Šà¸·à¹ˆà¸­ peer à¸—à¸µà¹ˆà¸¡à¸µà¸­à¸¢à¸¹à¹ˆ
    const connectionInfoEl = document.getElementById('connectionInfo'); // à¹à¸ªà¸”à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ connection

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // 4. Socket.io Event Handlers - à¸à¸²à¸£à¸ªà¸·à¹ˆà¸­à¸ªà¸²à¸£à¸à¸±à¸š Signalling Server
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // 4.1 à¹€à¸¡à¸·à¹ˆà¸­à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­à¸à¸±à¸š Signalling Server à¸ªà¸³à¹€à¸£à¹‡à¸ˆ
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    socket.on('connect', () => {
      // à¸­à¸±à¸à¹€à¸”à¸• UI à¹à¸ªà¸”à¸‡à¸§à¹ˆà¸²à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­à¸ªà¸³à¹€à¸£à¹‡à¸ˆ
      statusEl.textContent = 'Connected to Signalling Server';
      statusEl.className = 'status connected';
      
      // à¸ªà¹ˆà¸‡ peerId à¹„à¸›à¸¥à¸‡à¸—à¸°à¹€à¸šà¸µà¸¢à¸™à¸à¸±à¸š server
      socket.emit('register', PEER_ID);
      
      // à¹à¸ªà¸”à¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¹ƒà¸™ chat
      addMessage('System', 'à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­ Signalling Server à¸ªà¸³à¹€à¸£à¹‡à¸ˆ', 'system');
    });

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // 4.2 à¸£à¸±à¸šà¸£à¸²à¸¢à¸Šà¸·à¹ˆà¸­ Peers à¸—à¸µà¹ˆà¸¡à¸µà¸­à¸¢à¸¹à¹ˆà¹à¸¥à¹‰à¸§à¹ƒà¸™à¸£à¸°à¸šà¸š
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    socket.on('peers-list', (peers) => {
      // à¸­à¸±à¸à¹€à¸”à¸•à¸£à¸²à¸¢à¸Šà¸·à¹ˆà¸­ peer à¸—à¸µà¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­à¹„à¸”à¹‰
      updatePeersList(peers);
    });

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // 4.3 à¹€à¸¡à¸·à¹ˆà¸­à¸¡à¸µ Peer à¹ƒà¸«à¸¡à¹ˆà¹€à¸‚à¹‰à¸²à¸¡à¸²à¹ƒà¸™à¸£à¸°à¸šà¸š
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    socket.on('peer-joined', (peerId) => {
      // à¹à¸ªà¸”à¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¹à¸ˆà¹‰à¸‡à¹€à¸•à¸·à¸­à¸™
      addMessage('System', `${peerId} à¹€à¸‚à¹‰à¸²à¸£à¹ˆà¸§à¸¡`, 'system');
      
      // à¸ªà¸£à¹‰à¸²à¸‡à¸›à¸¸à¹ˆà¸¡à¹ƒà¸«à¹‰à¸„à¸¥à¸´à¸à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­à¸à¸±à¸š peer à¹ƒà¸«à¸¡à¹ˆ
      const btn = document.createElement('button');
      btn.textContent = `Connect to ${peerId}`;
      btn.onclick = () => connectToPeer(peerId);
      peersListEl.appendChild(btn);
    });

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // 4.4 à¹€à¸¡à¸·à¹ˆà¸­à¸¡à¸µ Peer à¸­à¸­à¸à¸ˆà¸²à¸à¸£à¸°à¸šà¸š
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    socket.on('peer-left', (peerId) => {
      addMessage('System', `${peerId} à¸­à¸­à¸à¸ˆà¸²à¸à¸£à¸°à¸šà¸š`, 'system');
      updatePeersList([]);  // à¸¥à¹‰à¸²à¸‡à¸£à¸²à¸¢à¸Šà¸·à¹ˆà¸­ peer
    });

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // 4.5 à¸£à¸±à¸š SDP Offer à¸ˆà¸²à¸ Peer à¸­à¸·à¹ˆà¸™ (à¸à¸£à¸“à¸µà¹€à¸£à¸²à¹€à¸›à¹‡à¸™à¸à¹ˆà¸²à¸¢à¸•à¸­à¸šà¸£à¸±à¸š)
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    socket.on('offer', async (data) => {
      try {
        addMessage('System', `à¹„à¸”à¹‰à¸£à¸±à¸š Offer à¸ˆà¸²à¸ ${data.from}`, 'system');
        
        // à¸–à¹‰à¸²à¸¡à¸µ connection à¹€à¸à¹ˆà¸²à¸­à¸¢à¸¹à¹ˆ à¹ƒà¸«à¹‰à¸›à¸´à¸”à¸à¹ˆà¸­à¸™
        if (peerConnection) {
          addMessage('System', 'à¸›à¸´à¸” connection à¹€à¸à¹ˆà¸²...', 'system');
          peerConnection.close();
          peerConnection = null;
        }
        
        // à¹€à¸à¹‡à¸šà¸Šà¸·à¹ˆà¸­ peer à¸—à¸µà¹ˆà¸ªà¹ˆà¸‡ offer à¸¡à¸²
        remotePeerId = data.from;
        
        // à¸ªà¸£à¹‰à¸²à¸‡ peer connection (isInitiator = false à¹€à¸à¸£à¸²à¸°à¹€à¸£à¸²à¹„à¸¡à¹ˆà¹„à¸”à¹‰à¹€à¸›à¹‡à¸™à¸„à¸™à¹€à¸£à¸´à¹ˆà¸¡)
        await createPeerConnection(false);
        
        // à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸² Remote Description à¸ˆà¸²à¸ offer à¸—à¸µà¹ˆà¹„à¸”à¹‰à¸£à¸±à¸š
        await peerConnection.setRemoteDescription(new RTCSessionDescription(data.offer));
        
        // à¸ªà¸£à¹‰à¸²à¸‡ Answer à¹€à¸›à¹‡à¸™à¸à¸²à¸£à¸•à¸­à¸šà¸à¸¥à¸±à¸š
        const answer = await peerConnection.createAnswer();
        
        // à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸² Local Description à¹€à¸›à¹‡à¸™ answer à¸—à¸µà¹ˆà¹€à¸£à¸²à¸ªà¸£à¹‰à¸²à¸‡
        await peerConnection.setLocalDescription(answer);
        
        // à¸ªà¹ˆà¸‡ answer à¸à¸¥à¸±à¸šà¹„à¸›à¹ƒà¸«à¹‰ peer à¸—à¸µà¹ˆà¸ªà¹ˆà¸‡ offer à¸¡à¸² à¸œà¹ˆà¸²à¸™ Signalling Server
        socket.emit('answer', {
          answer: answer,
          target: data.from,
          from: PEER_ID
        });
        
        addMessage('System', `à¸ªà¹ˆà¸‡ Answer à¸à¸¥à¸±à¸šà¹„à¸›à¸¢à¸±à¸‡ ${data.from}`, 'system');
      } catch (error) {
        // à¸ˆà¸±à¸”à¸à¸²à¸£ error à¸–à¹‰à¸²à¸¡à¸µà¸›à¸±à¸à¸«à¸²
        addMessage('System', `âŒ Error handling offer: ${error.message}`, 'system');
        console.error('Error in offer handler:', error);
      }
    });

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // 4.6 à¸£à¸±à¸š SDP Answer à¸ˆà¸²à¸ Peer à¸­à¸·à¹ˆà¸™ (à¸à¸£à¸“à¸µà¹€à¸£à¸²à¹€à¸›à¹‡à¸™à¸à¹ˆà¸²à¸¢à¹€à¸£à¸´à¹ˆà¸¡)
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    socket.on('answer', async (data) => {
      addMessage('System', `à¹„à¸”à¹‰à¸£à¸±à¸š Answer à¸ˆà¸²à¸ ${data.from}`, 'system');
      
      // à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸² Remote Description à¹€à¸›à¹‡à¸™ answer à¸—à¸µà¹ˆà¹„à¸”à¹‰à¸£à¸±à¸š
      // à¹€à¸¡à¸·à¹ˆà¸­à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²à¹€à¸ªà¸£à¹‡à¸ˆ WebRTC à¸ˆà¸°à¹€à¸£à¸´à¹ˆà¸¡à¸—à¸³ ICE checking à¹€à¸à¸·à¹ˆà¸­à¸«à¸²à¹€à¸ªà¹‰à¸™à¸—à¸²à¸‡à¸—à¸µà¹ˆà¸”à¸µà¸—à¸µà¹ˆà¸ªà¸¸à¸”
      await peerConnection.setRemoteDescription(new RTCSessionDescription(data.answer));
    });

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // 4.7 à¸£à¸±à¸š ICE Candidate à¸ˆà¸²à¸ Peer à¸­à¸·à¹ˆà¸™
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ICE Candidate à¸„à¸·à¸­à¹€à¸ªà¹‰à¸™à¸—à¸²à¸‡à¸—à¸µà¹ˆà¹€à¸›à¹‡à¸™à¹„à¸›à¹„à¸”à¹‰à¹ƒà¸™à¸à¸²à¸£à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­
    socket.on('ice-candidate', async (data) => {
      if (peerConnection && data.candidate) {
        // à¹€à¸à¸´à¹ˆà¸¡ ICE candidate à¸—à¸µà¹ˆà¹„à¸”à¹‰à¸£à¸±à¸šà¹€à¸‚à¹‰à¸²à¹„à¸›à¹ƒà¸™ peer connection
        // WebRTC à¸ˆà¸°à¸¥à¸­à¸‡à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­à¸œà¹ˆà¸²à¸™ candidate à¸™à¸µà¹‰
        await peerConnection.addIceCandidate(new RTCIceCandidate(data.candidate));
        addMessage('System', `à¹€à¸à¸´à¹ˆà¸¡ ICE Candidate à¸ˆà¸²à¸ ${data.from}`, 'system');
      }
    });

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // 5. Helper Functions - à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¸Šà¹ˆà¸§à¸¢à¹€à¸«à¸¥à¸·à¸­
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // 5.1 à¸­à¸±à¸à¹€à¸”à¸•à¸£à¸²à¸¢à¸Šà¸·à¹ˆà¸­ Peers à¸—à¸µà¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­à¹„à¸”à¹‰
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function updatePeersList(peers) {
      peersListEl.innerHTML = '';  // à¸¥à¹‰à¸²à¸‡à¸£à¸²à¸¢à¸Šà¸·à¹ˆà¸­à¹€à¸à¹ˆà¸²
      
      // à¸§à¸™à¸ªà¸£à¹‰à¸²à¸‡à¸›à¸¸à¹ˆà¸¡à¸ªà¸³à¸«à¸£à¸±à¸šà¹à¸•à¹ˆà¸¥à¸° peer
      peers.forEach(peerId => {
        const btn = document.createElement('button');
        btn.textContent = `Connect to ${peerId}`;
        btn.onclick = () => connectToPeer(peerId);  // à¸à¸”à¸›à¸¸à¹ˆà¸¡à¹à¸¥à¹‰à¸§à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­
        peersListEl.appendChild(btn);
      });
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // 5.2 à¹€à¸£à¸´à¹ˆà¸¡à¸à¸²à¸£à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­à¸à¸±à¸š Peer à¸­à¸·à¹ˆà¸™
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function connectToPeer(peerId) {
      // à¸–à¹‰à¸²à¸¡à¸µ connection à¹€à¸à¹ˆà¸²à¸­à¸¢à¸¹à¹ˆ à¹ƒà¸«à¹‰à¸›à¸´à¸”à¸à¹ˆà¸­à¸™
      if (peerConnection) {
        addMessage('System', 'à¸¡à¸µ connection à¸­à¸¢à¸¹à¹ˆà¹à¸¥à¹‰à¸§ à¸à¸³à¸¥à¸±à¸‡à¸›à¸´à¸” connection à¹€à¸à¹ˆà¸²...', 'system');
        peerConnection.close();
        peerConnection = null;
      }
      
      // à¹€à¸à¹‡à¸šà¸Šà¸·à¹ˆà¸­ peer à¸—à¸µà¹ˆà¹€à¸£à¸²à¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­
      remotePeerId = peerId;
      addMessage('System', `à¸à¸³à¸¥à¸±à¸‡à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­à¸à¸±à¸š ${peerId}...`, 'system');
      
      // à¸ªà¸£à¹‰à¸²à¸‡ peer connection à¹à¸¥à¸°à¸ªà¹ˆà¸‡ offer (isInitiator = true)
      await createPeerConnection(true);
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // 6. à¸ªà¸£à¹‰à¸²à¸‡ WebRTC Peer Connection
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¸ªà¸³à¸„à¸±à¸à¸—à¸µà¹ˆà¸ªà¸¸à¸”! à¸ªà¸£à¹‰à¸²à¸‡à¸à¸²à¸£à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­ WebRTC
    async function createPeerConnection(isInitiator) {
      // à¸ªà¸£à¹‰à¸²à¸‡ RTCPeerConnection object à¸”à¹‰à¸§à¸¢ configuration à¸—à¸µà¹ˆà¸¡à¸µ STUN server
      peerConnection = new RTCPeerConnection(configuration);

      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // 6.1 Event: onicecandidate - à¹€à¸¡à¸·à¹ˆà¸­à¸«à¸² ICE candidate à¹„à¸”à¹‰
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // à¸—à¸¸à¸à¸„à¸£à¸±à¹‰à¸‡à¸—à¸µà¹ˆ WebRTC à¸«à¸²à¹€à¸ªà¹‰à¸™à¸—à¸²à¸‡à¸à¸²à¸£à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­à¸—à¸µà¹ˆà¹€à¸›à¹‡à¸™à¹„à¸›à¹„à¸”à¹‰ (candidate)
      // à¹€à¸£à¸²à¸•à¹‰à¸­à¸‡à¸ªà¹ˆà¸‡à¹„à¸›à¹ƒà¸«à¹‰ peer à¸­à¸·à¹ˆà¸™à¸œà¹ˆà¸²à¸™ Signalling Server
      peerConnection.onicecandidate = (event) => {
        if (event.candidate) {
          // à¸ªà¹ˆà¸‡ candidate à¹„à¸›à¹ƒà¸«à¹‰ peer à¸­à¸·à¹ˆà¸™à¸œà¹ˆà¸²à¸™ Socket.io
          socket.emit('ice-candidate', {
            candidate: event.candidate,
            target: remotePeerId,
            from: PEER_ID
          });
          addMessage('System', 'à¸ªà¹ˆà¸‡ ICE Candidate', 'system');
        }
        // à¸–à¹‰à¸² event.candidate à¹€à¸›à¹‡à¸™ null à¹à¸ªà¸”à¸‡à¸§à¹ˆà¸²à¸«à¸² candidate à¸„à¸£à¸šà¹à¸¥à¹‰à¸§
      };

      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // 6.2 Event: onconnectionstatechange - à¸•à¸´à¸”à¸•à¸²à¸¡à¸ªà¸–à¸²à¸™à¸°à¸à¸²à¸£à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // à¸ªà¸–à¸²à¸™à¸°à¸—à¸µà¹ˆà¹€à¸›à¹‡à¸™à¹„à¸›à¹„à¸”à¹‰: new -> connecting -> connected -> disconnected -> closed
      peerConnection.onconnectionstatechange = () => {
        const state = peerConnection.connectionState;
        connectionInfoEl.innerHTML = `<strong>Connection State:</strong> ${state}`;
        addMessage('System', `Connection State: ${state}`, 'system');
        
        // à¹€à¸¡à¸·à¹ˆà¸­à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­à¸ªà¸³à¹€à¸£à¹‡à¸ˆ
        if (state === 'connected') {
          addMessage('System', 'âœ… à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­ P2P à¸ªà¸³à¹€à¸£à¹‡à¸ˆ! à¸•à¸­à¸™à¸™à¸µà¹‰à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¹ˆà¸‡à¸•à¸£à¸‡à¸£à¸°à¸«à¸§à¹ˆà¸²à¸‡ peer', 'system');
        }
      };

      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // 6.3 Event: oniceconnectionstatechange - à¸•à¸´à¸”à¸•à¸²à¸¡ ICE connection
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // à¸ªà¸–à¸²à¸™à¸°à¸‚à¸­à¸‡ ICE: new -> checking -> connected -> completed
      peerConnection.oniceconnectionstatechange = () => {
        const state = peerConnection.iceConnectionState;
        addMessage('System', `ICE Connection State: ${state}`, 'system');
      };

      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // 6.4 à¹à¸¢à¸à¸à¸²à¸£à¸—à¸³à¸‡à¸²à¸™à¸•à¸²à¸¡ Role: Initiator à¸«à¸£à¸·à¸­ Responder
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      if (isInitiator) {
        // à¸à¸£à¸“à¸µà¹€à¸£à¸²à¹€à¸›à¹‡à¸™à¸à¹ˆà¸²à¸¢à¹€à¸£à¸´à¹ˆà¸¡à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­ (à¸ªà¹ˆà¸‡ Offer)
        
        // à¸ªà¸£à¹‰à¸²à¸‡ Data Channel à¸ªà¸³à¸«à¸£à¸±à¸šà¸ªà¹ˆà¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡
        dataChannel = peerConnection.createDataChannel('chat');
        setupDataChannel();  // à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸² event handlers à¸‚à¸­à¸‡ channel
        
        // à¸ªà¸£à¹‰à¸²à¸‡ SDP Offer
        const offer = await peerConnection.createOffer();
        
        // à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸² Local Description à¹€à¸›à¹‡à¸™ offer à¸—à¸µà¹ˆà¹€à¸£à¸²à¸ªà¸£à¹‰à¸²à¸‡
        await peerConnection.setLocalDescription(offer);
        
        // à¸ªà¹ˆà¸‡ offer à¹„à¸›à¹ƒà¸«à¹‰ peer à¸­à¸·à¹ˆà¸™à¸œà¹ˆà¸²à¸™ Signalling Server
        socket.emit('offer', {
          offer: offer,
          target: remotePeerId,
          from: PEER_ID
        });
        
        addMessage('System', `à¸ªà¹ˆà¸‡ Offer à¹„à¸›à¸¢à¸±à¸‡ ${remotePeerId}`, 'system');
      } else {
        // à¸à¸£à¸“à¸µà¹€à¸£à¸²à¹€à¸›à¹‡à¸™à¸à¹ˆà¸²à¸¢à¸•à¸­à¸šà¸£à¸±à¸š (à¸£à¸±à¸š Offer à¹à¸¥à¸°à¸ªà¹ˆà¸‡ Answer)
        
        // à¸£à¸­à¸£à¸±à¸š Data Channel à¸ˆà¸²à¸ peer à¸­à¸·à¹ˆà¸™
        peerConnection.ondatachannel = (event) => {
          dataChannel = event.channel;  // à¹€à¸à¹‡à¸š channel à¸—à¸µà¹ˆà¹„à¸”à¹‰à¸£à¸±à¸š
          setupDataChannel();           // à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸² event handlers
        };
      }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // 7. à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸² Data Channel Events
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // Data Channel à¹€à¸›à¹‡à¸™à¸Šà¹ˆà¸­à¸‡à¸—à¸²à¸‡à¸ªà¸³à¸«à¸£à¸±à¸šà¸ªà¹ˆà¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸£à¸°à¸«à¸§à¹ˆà¸²à¸‡ peer
    function setupDataChannel() {
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // 7.1 Event: onopen - à¹€à¸¡à¸·à¹ˆà¸­ Data Channel à¹€à¸›à¸´à¸”à¸à¸£à¹‰à¸­à¸¡à¹ƒà¸Šà¹‰à¸‡à¸²à¸™
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      dataChannel.onopen = () => {
        addMessage('System', 'âœ… Data Channel à¹€à¸›à¸´à¸”à¹à¸¥à¹‰à¸§ - à¸à¸£à¹‰à¸­à¸¡à¸ªà¹ˆà¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡!', 'system');
        
        // à¹€à¸›à¸´à¸”à¹ƒà¸Šà¹‰à¸‡à¸²à¸™à¸Šà¹ˆà¸­à¸‡à¸à¸´à¸¡à¸à¹Œà¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¹à¸¥à¸°à¸›à¸¸à¹ˆà¸¡à¸ªà¹ˆà¸‡
        messageInput.disabled = false;
        sendBtn.disabled = false;
        messageInput.focus();  // à¹‚à¸Ÿà¸à¸±à¸ªà¹„à¸›à¸—à¸µà¹ˆà¸Šà¹ˆà¸­à¸‡à¸à¸´à¸¡à¸à¹Œ
      };

      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // 7.2 Event: onclose - à¹€à¸¡à¸·à¹ˆà¸­ Data Channel à¸›à¸´à¸”
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      dataChannel.onclose = () => {
        addMessage('System', 'Data Channel à¸›à¸´à¸”à¹à¸¥à¹‰à¸§', 'system');
        
        // à¸›à¸´à¸”à¸à¸²à¸£à¹ƒà¸Šà¹‰à¸‡à¸²à¸™à¸Šà¹ˆà¸­à¸‡à¸à¸´à¸¡à¸à¹Œà¹à¸¥à¸°à¸›à¸¸à¹ˆà¸¡à¸ªà¹ˆà¸‡
        messageInput.disabled = true;
        sendBtn.disabled = true;
      };

      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // 7.3 Event: onmessage - à¹€à¸¡à¸·à¹ˆà¸­à¹„à¸”à¹‰à¸£à¸±à¸šà¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸ˆà¸²à¸ peer à¸­à¸·à¹ˆà¸™
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      dataChannel.onmessage = (event) => {
        // à¹à¸ªà¸”à¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸—à¸µà¹ˆà¹„à¸”à¹‰à¸£à¸±à¸šà¹ƒà¸™ chat
        addMessage(remotePeerId, event.data, 'received');
      };
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // 8. à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¸ªà¹ˆà¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function sendMessage() {
      const message = messageInput.value.trim();  // à¸•à¸±à¸”à¸Šà¹ˆà¸­à¸‡à¸§à¹ˆà¸²à¸‡à¸«à¸™à¹‰à¸²-à¸«à¸¥à¸±à¸‡
      
      // à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸§à¹ˆà¸²à¸¡à¸µà¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¹à¸¥à¸° channel à¸à¸£à¹‰à¸­à¸¡à¸ªà¹ˆà¸‡à¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ
      if (message && dataChannel && dataChannel.readyState === 'open') {
        // à¸ªà¹ˆà¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸œà¹ˆà¸²à¸™ Data Channel (P2P à¸•à¸£à¸‡à¹„à¸›à¸«à¸² peer à¸­à¸·à¹ˆà¸™)
        dataChannel.send(message);
        
        // à¹à¸ªà¸”à¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸—à¸µà¹ˆà¹€à¸£à¸²à¸ªà¹ˆà¸‡à¹ƒà¸™ chat
        addMessage('You', message, 'sent');
        
        // à¸¥à¹‰à¸²à¸‡à¸Šà¹ˆà¸­à¸‡à¸à¸´à¸¡à¸à¹Œ
        messageInput.value = '';
      }
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // 8.1 Event Listeners à¸ªà¸³à¸«à¸£à¸±à¸šà¸à¸²à¸£à¸ªà¹ˆà¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    sendBtn.onclick = sendMessage;  // à¸„à¸¥à¸´à¸à¸›à¸¸à¹ˆà¸¡ "à¸ªà¹ˆà¸‡"
    
    messageInput.onkeypress = (e) => {
      if (e.key === 'Enter') sendMessage();  // à¸à¸” Enter à¹ƒà¸™à¸Šà¹ˆà¸­à¸‡à¸à¸´à¸¡à¸à¹Œ
    };

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // 9. à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¹€à¸à¸´à¹ˆà¸¡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¹ƒà¸™ Chat UI
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function addMessage(sender, message, type) {
      // à¸ªà¸£à¹‰à¸²à¸‡ div element à¸ªà¸³à¸«à¸£à¸±à¸šà¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡
      const msgEl = document.createElement('div');
      
      // à¹ƒà¸ªà¹ˆ class à¸•à¸²à¸¡à¸›à¸£à¸°à¹€à¸ à¸—à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡ (sent, received, system)
      msgEl.className = `message ${type}`;
      
      // à¹ƒà¸ªà¹ˆà¹€à¸™à¸·à¹‰à¸­à¸«à¸²à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡
      msgEl.innerHTML = `<strong>${sender}:</strong> ${message}`;
      
      // à¹€à¸à¸´à¹ˆà¸¡à¹€à¸‚à¹‰à¸²à¹„à¸›à¹ƒà¸™ messages container
      messagesEl.appendChild(msgEl);
      
      // à¹€à¸¥à¸·à¹ˆà¸­à¸™ scroll à¸¥à¸‡à¸¥à¹ˆà¸²à¸‡à¸ªà¸¸à¸”à¹€à¸à¸·à¹ˆà¸­à¹€à¸«à¹‡à¸™à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¹ƒà¸«à¸¡à¹ˆ
      messagesEl.scrollTop = messagesEl.scrollHeight;
    }
  </script>
</body>
</html>
